# music-stats map

  [![license][license-image]][license-url]
  ![code size][code-size-image]

![screenshot](https://user-images.githubusercontent.com/2470363/60399655-333c3a80-9b68-11e9-8ef4-1685b09bee0f.png)

## Tech stack

dev deps:
[`typescript`](https://www.typescriptlang.org/docs),
[`sass`](https://sass-lang.com/documentation/file.SASS_REFERENCE.html),
[`webpack`](https://webpack.js.org/api),
[`jest`](https://jestjs.io/docs/en/expect).

deps:
[`leaflet`](http://leafletjs.com),
[`d3-scale`](https://github.com/d3/d3-scale),
[`d3-scale-chromatic`](https://github.com/d3/d3-scale-chromatic),
[`d3-color`](https://github.com/d3/d3-color).

Flags (1x1) are taken from [flag-icon-css](https://github.com/lipis/flag-icon-css/tree/master/flags/1x1).

## Data source

There are two files the map relies on:

* [`data/world.geo.json`](data/world.geo.json) - generated by [GeoJSON Regions](https://geojson-maps.ash.ms)
* [`data/artists.json`](data/artists.json) - loaded from Last.fm and MusicBrainz, cleared and aggregated by [music-stats scripts](https://github.com/music-stats/scripts)

## Implementation details

No rendering/templating framework is used, though UI consists of several component-like (React-inspired) classes.

You can always find a `.render()` method there - in `<PlaycountMap />` it assembles children components together,
in other (presentational) components it returns HTML as a string
(using [tagged templates](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_templates))
and relying on `.props` + `.state`.

DOM event handlers are bound through `.subscribe()` methods.

Presentational components actually extend Leaflet's [`Control`](https://leafletjs.com/reference-1.3.4.html#control),
so `.onAdd()` is implemented there (responsible for `.element` rendering).

Styles are organized as SASS files alongside the components. BEM methodology is used for naming.

## Setup

### Environment variables

Create a `.env` file and fill its values according to [`.env.template`](.env.template):

* `MAPBOX_ACCESS_TOKEN` (see Mapbox [account](https://account.mapbox.com/access-tokens) and [docs](https://docs.mapbox.com/help/how-mapbox-works/access-tokens))

### Commands

```bash
$ npm i               # install deps
$ npm run lint        # lint scripts and styles
$ npm test            # run unit tests
$ npm run dev         # run a local dev server
$ npm run build:prod  # produce a build artifact
$ npm run deploy      # deploy to GitHub pages
```

[license-image]: https://img.shields.io/github/license/music-stats/map.svg?style=flat-square
[license-url]: https://github.com/music-stats/map/blob/master/LICENSE
[code-size-image]: https://img.shields.io/github/languages/code-size/music-stats/map.svg?style=flat-square
